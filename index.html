<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MySecondMind</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-xl mx-auto py-24 text-center space-y-6">
  <h1 class="text-3xl font-bold">MySecondMind</h1>
  <p class="text-gray-600">Choose a login method.</p>

  <!-- Option A: Telegram widget (keep if you want) -->
  <div id="tg-login" class="space-y-3"></div>

  <div class="text-gray-400">— or —</div>

  <!-- Option B: Code-based login (no popup) -->
  <div class="space-y-3">
    <button id="getCode" class="bg-blue-600 text-white px-6 py-3 rounded">Get login code</button>
    <div id="codeBox" class="hidden">
      <p class="text-sm">Send this in Telegram bot chat: <code class="font-mono bg-gray-100 px-2 py-1 rounded">/link <span id="codeValue"></span></code></p>
      <button id="checkLink" class="bg-gray-900 text-white px-4 py-2 rounded">I’ve linked – continue</button>
    </div>
  </div>
</div>

<script>
  const API_ORIGIN = 'https://mymind-924q.onrender.com'; // your API URL (no trailing slash)
  // Optional: keep Telegram widget too
  try {
    const botUsername = 'mysecondmind_assistant_bot'; // exact bot username (no @)
    const s = document.createElement('script');
    s.async = true;
    s.src = 'https://telegram.org/js/telegram-widget.js?22';
    s.setAttribute('data-telegram-login', botUsername);
    s.setAttribute('data-size', 'large');
    s.setAttribute('data-auth-url', `${API_ORIGIN}/auth/telegram`);
    document.getElementById('tg-login').appendChild(s);
  } catch {}

  // Code-based login
  const getCodeBtn = document.getElementById('getCode');
  const codeBox = document.getElementById('codeBox');
  const codeValue = document.getElementById('codeValue');
  const checkBtn = document.getElementById('checkLink');

  let currentCode = '';

  getCodeBtn.addEventListener('click', async () => {
    const res = await fetch(`${API_ORIGIN}/auth/start-link`, { method: 'POST' });
    const data = await res.json();
    currentCode = data.code;
    codeValue.textContent = currentCode;
    codeBox.classList.remove('hidden');
  });

  checkBtn.addEventListener('click', async () => {
    if (!currentCode) return;
    // If linked, server sets cookie and 302 redirects to /app.html
    window.location.href = `${API_ORIGIN}/auth/check-link?code=${encodeURIComponent(currentCode)}`;
  });
</script>
</body>
</html>
